var moby={version:"0.1.0"};moby.idx=0,moby.init=function(){var t={containerSelector:null,width:300,height:200,type:"bar",transitionDuration:200,labelFormatter:moby.utils.formatLabel},e=null;d3.select(window).on("resize."+moby.idx++,moby.utils.debounce(function(){r()},300));var n={line:moby.renderLine,bar2D:moby.renderBar2D,bubble:moby.renderBubble,bar:moby.renderBar},r=function(r){return r?e=r:r=e,t.width=d3.select(t.containerSelector).node().offsetWidth,n[t.type](r,t),this},a=function(e){return moby.utils.override(e,t),this};return{render:r,setConfig:a}},moby.utils={},moby.utils.formatLabel=function(t){var e="";return t.name&&(e+='<span class="label-title">'+t.name+"</span>"),t.values&&(e+='<span class="label-value">('+d3.max(t.values)+")</span>"),e},moby.utils.generateRandomString=function(){return d3.range(~~(20*Math.random())+5).map(function(){return String.fromCharCode(26*Math.random()+65)}).join("")},moby.utils.generateData1D=function(t){return d3.range(t).map(function(){return{name:moby.utils.generateRandomString(),values:[~~(100*Math.random())]}})},moby.utils.generateData2D=function(t,e){return d3.range(t).map(function(){return{name:moby.utils.generateRandomString(),values:d3.range(e).map(function(){return~~(100*Math.random())})}})},moby.utils.debounce=function(t,e,n){var r;return function(){var a=this,i=arguments;clearTimeout(r),r=setTimeout(function(){r=null,n||t.apply(a,i)},e),n&&!r&&t.apply(a,i)}},moby.utils.override=function(t,e){for(var n in t)n in e&&(e[n]=t[n])},moby.renderLine=function(t,e){var n=d3.select(e.containerSelector).selectAll("div.chart").data(t);n.enter().append("div").attr({"class":"line chart"}),n.style({width:e.width+"px",height:e.height+"px"}),n.exit().remove();var r=n.selectAll("div.line").data(function(t){return t.values});r.enter().append("div").attr({"class":"line"}).style({height:"2px",width:function(n,r,a){return e.width/t[a].values.length+"px"},left:function(n,r,a){var i=e.width/t[a].values.length;return i*r+i/2+"px"},"-webkit-transform-origin":"0% 0%","transform-origin":"0% 0%","-webkit-transform":"rotate(0rad)",transform:"rotate(0rad)",position:"absolute"});var a=function(t,n){var r=this.parentNode.__data__,a=e.height-t*e.height/d3.max(r.values),i=Math.min(n+1,r.values.length-1),l=e.height-r.values[i]*e.height/d3.max(r.values),o=l-a,u=e.width/r.values.length;return d3.interpolateString(this.style.webkitTransform,"rotate("+Math.atan2(o,u)+"rad)")};r.transition().duration(e.transitionDuration).styleTween("-webkit-transform",a).styleTween("transform",a).style({width:function(t,n){var r=this.parentNode.__data__,a=e.height-t*e.height/d3.max(r.values),i=Math.min(n+1,r.values.length-1),l=e.height-r.values[i]*e.height/d3.max(r.values),o=l-a,u=e.width/r.values.length;return Math.sqrt(o*o+u*u)+"px"},top:function(n,r,a){return e.height-n*e.height/d3.max(t[a].values)+"px"},left:function(n,r,a){var i=e.width/t[a].values.length;return i*r+i/2+"px"},display:function(e,n,r){return n===t[r].values.length-1?"none":"block"}}),r.exit().remove();var i=5,l=n.selectAll("div.dot").data(function(t){return t.values});l.enter().append("div").attr({"class":"dot"}).style({left:function(n,r,a){var l=e.width/t[a].values.length;return l*r-i+l/2+"px"},top:function(n,r,a){return e.height-n*e.height/d3.max(t[a].values)-i+"px"},width:2*i+"px",height:2*i+"px","border-radius":i+"px",position:"absolute"}),l.transition().duration(e.transitionDuration).style({left:function(n,r,a){var l=e.width/t[a].values.length;return l*r-i+l/2+"px"},top:function(n,r,a){return e.height-n*e.height/d3.max(t[a].values)-i+"px"},width:2*i+"px",height:2*i+"px","border-radius":i+"px",position:"absolute"}),l.exit().remove();var o=n.selectAll("div.label").data(function(t){return[t]});return o.enter().append("div").attr({"class":"label"}).style({width:e.width+"px",height:e.height-2+"px",position:"absolute"}),o.html(e.labelFormatter),o.exit().remove(),this},moby.renderBar=function(t,e){var n=d3.select(e.containerSelector).selectAll("div.chart").data(t);n.enter().append("div").attr({"class":"bar chart"}),n.style({width:e.width+"px",height:e.height+"px"}),n.exit().remove();var r=n.selectAll("div.bar").data(function(t){return t.values});r.enter().append("div").attr({"class":"bar"}).style({width:e.width+"px",height:e.height-2+"px"}),r.transition().duration(e.transitionDuration).style({width:function(n){return n/d3.max(d3.merge(t.map(function(t){return t.values})))*e.width-2+"px"}}),r.exit().remove();var a=n.selectAll("div.label").data(function(t){return[t]});a.enter().append("div").attr({"class":"label"}).style({width:e.width+"px",height:e.height-2+"px",position:"absolute"}),a.style({width:e.width+"px"}).html(e.labelFormatter),a.exit().remove()},moby.renderBar2D=function(t,e){var n=d3.select(e.containerSelector).selectAll("div.chart").data(t);n.enter().append("div").attr({"class":"bar2d chart"}),n.style({width:e.width+"px",height:e.height+"px"}),n.exit().remove();var r=n.selectAll("div.bar").data(function(t){return t.values});r.enter().append("div").attr({"class":"bar"}).style({left:function(n,r,a){return r*e.width/t[a].values.length+"px"},top:e.height+"px",width:function(n,r,a){return e.width/t[a].values.length+"px"},height:"0px",position:"absolute"}),r.transition().duration(e.transitionDuration).style({left:function(n,r,a){return r*e.width/t[a].values.length+"px"},top:function(n,r,a){return e.height-n*e.height/d3.max(t[a].values)+"px"},width:function(n,r,a){return e.width/t[a].values.length-2+"px"},height:function(n,r,a){return n/d3.max(t[a].values)*e.height-2+"px"}}),r.exit().remove();var a=n.selectAll("div.label").data(function(t){return[t]});return a.enter().append("div").attr({"class":"label"}).style({width:e.width+"px",height:e.height-2+"px",position:"absolute"}),a.html(e.labelFormatter),a.exit().remove(),this},moby.renderBubble=function(t,e){var n=t.map(function(t){return{key:t.name,value:t.values[0]}}),r=d3.layout.pack().sort(null).size([e.width,e.height]).padding(2).value(function(t){return t.value}),a=d3.select(e.containerSelector).selectAll("div.chart").data([0]);a.enter().append("div").attr({"class":"bubble chart"}),a.style({width:e.width+"px",height:e.height+"px"});var i=function(t){return"translate("+(t.x-t.r)+"px,"+(t.y-t.r)+"px)"},l=function(t){return d3.interpolateString(this.style.webkitTransform,i(t))},o=a.selectAll(".node").data(r.nodes({key:"a",value:1,children:n}));return o.enter().append("div").attr({"class":"node"}).style({"-webkit-transform":i,transform:i}).style({position:"absolute","text-align":"center"}),o.html(function(t){return e.labelFormatter({name:t.key,values:[t.value]})}).transition().duration(e.transitionDuration).styleTween("-webkit-transform",l).styleTween("transform",l).style({width:function(t){return 2*t.r+"px"},height:function(t){return 2*t.r+"px"},"border-radius":function(t){return t.r+"px"},"font-size":function(t){return 4*~~(t.r/t.key.length)+"px"},"padding-top":function(t,e){return 0!==e?4*~~(t.r/t.key.length)+"px":void 0}}),o.exit().remove(),d3.select(o[0][0]).classed("top",!0).text(""),this};